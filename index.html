<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>桃園機場｜實習相簿</title>

<!-- 字體：Noto Sans TC（清楚、適合手機） -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">

<style>
  :root{
    /* 顏色 */
    --bg:#0b0f14; --fg:#e8f0ff; --brand:#00c2ff; --muted:#9aa4b2;
    /* 手機優先的字級，桌面再放大 */
    --title-size: clamp(16px, 5.5vw, 28px);   /* 第一行大字 */
    --hint-size:  clamp(11px, 3.6vw, 14px);   /* 第二行小字 */
    --cap-size:   clamp(13px, 3.8vw, 18px);   /* 左下字幕 */
    --wm-size:    clamp(12px, 3.5vw, 18px);   /* 右下水印（小螢幕自動隱藏） */
    --top-pad: calc(env(safe-area-inset-top, 0px) + 10px);
    --side-pad: calc(env(safe-area-inset-left, 0px) + 12px);
    --trans: 800ms;                           /* 照片淡入時間 */
  }

  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg)}
  body{font-family:"Noto Sans TC",system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"PingFang TC","Microsoft JhengHei",sans-serif}

  /* 頂部兩行抬頭（固定在上） */
  .topbar{
    position:fixed;left:0;right:0;top:0;z-index:10;
    padding: var(--top-pad) var(--side-pad) 8px var(--side-pad);
    background: linear-gradient(180deg, rgba(0,0,0,.68), rgba(0,0,0,0));
  }
  .title{
    font-weight:900;font-size:var(--title-size);line-height:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    text-shadow: 0 1px 2px rgba(0,0,0,.35);
  }
  .title b{ color:var(--brand); }
  .hint{
    margin-top:6px;color:var(--muted);font-size:var(--hint-size);line-height:1.2;
    text-shadow: 0 1px 1px rgba(0,0,0,.3);
  }

  /* 舞台區：圖片置中顯示 */
  .stage{position:fixed;inset:0;display:grid;place-items:center}
  .wrap{position:relative;width:100%;height:100%}
  .slide{position:absolute;inset:0;display:grid;place-items:center;opacity:0;transition:opacity var(--trans) ease}
  .slide.show{opacity:1}
  img.photo{max-width:100%;max-height:100%;object-fit:contain;image-rendering:auto}

  /* 左下字幕（編號｜名稱） */
  .caption{
    position:fixed;left:var(--side-pad);
    bottom:calc(env(safe-area-inset-bottom, 0px) + 10px);
    color:var(--muted);font-size:var(--cap-size);
    text-shadow: 0 1px 2px rgba(0,0,0,.35);
    z-index:10;
  }
  .cap-in{animation:capIn .5s ease both}
  @keyframes capIn{from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)}}

  /* 右下水印（小螢幕自動隱藏） */
  .wm{
    position:fixed;right:var(--side-pad);
    bottom:calc(env(safe-area-inset-bottom, 0px) + 10px);
    color:var(--brand);font-weight:900;font-size:var(--wm-size);z-index:10;
    text-shadow:0 1px 2px rgba(0,0,0,.35);
  }
  @media (max-width: 480px) { .wm{ display:none; } } /* 會擋到就自動隱藏 */

  /* 動效無障礙：若使用者偏好減少動態，就關閉動畫 */
  @media (prefers-reduced-motion: reduce) {
    .slide { transition: none !important; }
    .cap-in { animation: none !important; }
  }
</style>
</head>
<body>
  <!-- 手機優先的兩行抬頭 -->
  <div class="topbar">
    <div class="title">桃園機場 <b>TIAC</b>｜114實習相簿</div>
    <div class="hint">左右滑動或點按：上一張／下一張　點一下：暫停／播放</div>
  </div>

  <div class="stage"><div class="wrap" id="wrap">
    <!-- 交替淡入用的雙層 -->
    <div class="slide" id="s0"><img class="photo" alt=""></div>
    <div class="slide" id="s1"><img class="photo" alt=""></div>
  </div></div>

  <div class="caption" id="cap"></div>
  <div class="wm" id="wm">= 2025 SUMMER =</div>

<script>
/* 參數（保留你的設定） */
const MAX_SCAN = 200;
const EXTS = ['jpg','jpeg','png','webp','JPG','JPEG','PNG','WEBP']; // 大小寫都支援
const INTERVAL_MS = 3600;
const TRANSITION_MS = 800;
const TYPE_MS_PER_CHAR = 18;
const USE_PHOTOS_TXT = true;

/* 工具 */
const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
function preloadOk(url){
  return new Promise(res=>{
    const img = new Image();
    img.onload = ()=>res(true);
    img.onerror = ()=>res(false);
    img.src = url + (url.includes('?')?'&':'?') + 't=' + Date.now(); // 防快取
  });
}

/* 讀 photos.txt（容錯：trim、BOM、允許「檔名 | 標題」與標題內含 |） */
async function listFromTxt(){
  try{
    const r = await fetch('photos/photos.txt',{cache:'no-store'});
    if(!r.ok) return [];
    const raw = (await r.text()).replace(/^\uFEFF/,'');
    const rows = raw.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    const list = rows.map(line=>{
      const [nameRaw, ...rest] = line.split('|');
      const name = (nameRaw||'').replace(/^\uFEFF/,'').trim();
      const titleRaw = rest.join('|').trim();
      const src = `photos/${name}`;
      const title = (titleRaw || name).replace(/\.(jpe?g|png|webp)$/i,'');
      return {src, title};
    });
    const ok = [];
    for(const it of list){ if(await preloadOk(it.src)) ok.push(it); }
    return ok;
  }catch{ return []; }
}

/* 連號掃描（不中斷，遇缺號照掃到 MAX_SCAN） */
async function listFromScan(){
  const out=[];
  for(let i=1;i<=MAX_SCAN;i++){
    const num = String(i).padStart(3,'0');
    let hit=null;
    for(const ext of EXTS){
      const url = `photos/${num}.${ext}`;
      if(await preloadOk(url)){ hit=url; break; }
    }
    if(hit){ out.push({src:hit, title:num}); }
  }
  return out;
}

/* 取得清單：先 txt（有就用）→ 否則掃描 */
async function getPhotos(){
  if(USE_PHOTOS_TXT){
    const a = await listFromTxt();
    if(a.length) return a;
  }
  return await listFromScan();
}

/* 左下字幕（001｜名稱）＋打字動畫 */
let capToken = 0;
function setCaption(idx, title){
  const cap = document.getElementById('cap');
  const n = String(idx+1).padStart(3,'0');
  const text = `${n}｜${title||''}`;
  cap.classList.remove('cap-in'); void cap.offsetWidth; cap.classList.add('cap-in');
  const my = ++capToken; cap.textContent=''; let i=0;
  (function step(){ if(my!==capToken) return;
    cap.textContent = text.slice(0, i++); if(i<=text.length) setTimeout(step, TYPE_MS_PER_CHAR);
  })();
}

(async function main(){
  const photos = await getPhotos();
  if(!photos.length){
    document.body.innerHTML = "<div style='color:#fff;padding:calc(var(--top-pad) + 40px) var(--side-pad)'>找不到任何照片（請在 <code>photos/</code> 放 001.jpg、002.jpg… 或在 <code>photos/photos.txt</code> 每行寫 <code>檔名|字幕</code>）</div>";
    return;
  }

  const s0 = document.getElementById('s0'), s1 = document.getElementById('s1');
  s0.style.setProperty('--trans', TRANSITION_MS+'ms');
  s1.style.setProperty('--trans', TRANSITION_MS+'ms');

  let cur=0, showA=true, playing=true, timer=null;

  async function show(idx){
    const ph = photos[idx];
    const target = showA ? s1 : s0;
    const img = target.querySelector('img');

    // 單張容錯：載入失敗就跳下一張
    if(!(await preloadOk(ph.src))){
      cur = (cur+1)%photos.length;
      await show(cur);
      return;
    }
    img.src = ph.src;
    setCaption(idx, ph.title);

    (showA ? s0 : s1).classList.remove('show');
    target.classList.add('show');
    showA = !showA;

    // 預載下一張（不阻塞）
    const nextIdx = (idx+1)%photos.length;
    preloadOk(photos[nextIdx].src);
  }

  function next(){ cur = (cur+1)%photos.length; show(cur); }
  function prev(){ cur = (cur-1+photos.length)%photos.length; show(cur); }

  await show(0);
  let timerId = setInterval(next, INTERVAL_MS);

  /* 播放/暫停：確保不重複開 interval */
  function play(p){
    playing = p;
    clearInterval(timerId);
    if(playing) timerId = setInterval(next, INTERVAL_MS);
  }

  /* 點擊切換播放；鍵盤左右切換（桌面） */
  document.addEventListener('click', ()=>play(!playing));
  document.addEventListener('keydown', e=>{
    if(e.code==='Space'){ e.preventDefault(); play(!playing); }
    else if(e.key==='ArrowRight'){ next(); }
    else if(e.key==='ArrowLeft'){ prev(); }
  });

  /* 手機左右滑動切換 */
  let touchX = null;
  document.addEventListener('touchstart', e => { touchX = e.touches[0].clientX; }, {passive:true});
  document.addEventListener('touchend',   e => {
    if (touchX == null) return;
    const dx = e.changedTouches[0].clientX - touchX;
    touchX = null;
    if (Math.abs(dx) > 40) (dx < 0 ? next() : prev());
  }, {passive:true});
})();
</script>
</body>
</html>

